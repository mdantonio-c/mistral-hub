<nav class="map-sidenav" [class.collapsed]="isCollapsed">
  <div class="map-sidenav-menu">
    <!-- partial collapse -->
    <label
      class="toggle"
      (click)="changeCollapse()"
      [class.collapsed]="isCollapsed"
    ></label>
    <ul class="selector">
      <!--
      <li class="sidenav-item">
        <span
          class="modes clickable"
          placement="left"
          [ngbTooltip]="'Modality'"
          [disableTooltip]="!isCollapsed"
        ></span>
        <ng-container *ngIf="!isCollapsed">
          <a href="#" click-stop-propagation class="mode">
            <span class="nav-text" i18n >Modality</span>
          </a>
          <div class="selettore-modality d-flex">
            <div class="form-switch mode-switch d-flex mb-3">
              <input
                id="modeSwitch"
                type="checkbox"
                class="form-check-input"
              />
            </div>
            <p class="nav-sub-text">
                Selected: <span>{{ modes[1] }}</span
                >
              </p>
          </div>
        </ng-container>
      </li>
      -->
      <li class="sidenav-item last pb-1" *ngIf="mode == modes.adv" ngbDropdown>
        <span
          class="input clickable"
          placement="left"
          [ngbTooltip]="'Dataset'"
          [disableTooltip]="!isCollapsed"
        ></span>
        <ng-container *ngIf="!isCollapsed">
          <a
            href="#"
            click-stop-propagation
            class="dataset"
            id="dropdownDataset"
            ngbDropdownToggle
          >
            <span class="nav-text" i18n>Dataset</span>
          </a>
          <div
            class="position-relative text-start submenu selettore-dataset"
            ngbDropdownMenu
            aria-labelledby="dropdownDataset"
          >
            <ng-container *ngFor="let ds of availableDatasets">
              <a
                class="p-0"
                id="{{ ds.code }}"
                href="#"
                (click)="changeDataset($event, ds.code)"
                [ngClass]="{ selected: dataset === ds.code }"
                ngbDropdownItem
                >{{ ds.desc }}</a
              >
            </ng-container>
          </div>
        </ng-container>
      </li>
      <ng-container *ngIf="dataset === 'iff'; then iff; else cosmo">
      </ng-container>
      <ng-template #iff>
        <li class="sidenav-item">
          <span
            class="tpperc clickable attivo"
            (click)="toggleLayer($event, 'tpperc')"
            placement="left"
            [ngbTooltip]="'Precipitation percentile'"
            [disableTooltip]="!isCollapsed"
          ></span>
          <ng-container *ngIf="!isCollapsed">
            <a href="#" (click)="toggleLayer($event, 'tpperc')">
              <span class="nav-text">Precipitation percentile</span>
            </a>
            <span class="nav-sub-text">(mm)</span>
            <div class="selettore-percentile">
              <label *ngFor="let p of subLevels['tpperc']" class="clickable">
                <input
                  type="radio"
                  name="iff_percentile"
                  [checked]="p.checked"
                  [value]="p.value"
                  (change)="changeSubLevel($event, p, 'tpperc')"
                />
                {{ p.value }}
              </label>
            </div>
          </ng-container>
        </li>
        <li class="sidenav-item last">
          <span
            class="tpprob clickable"
            (click)="toggleLayer($event, 'tpprob')"
            placement="left"
            [ngbTooltip]="'Precipitation probability'"
            [disableTooltip]="!isCollapsed"
          ></span>
          <ng-container *ngIf="!isCollapsed">
            <a href="#" (click)="toggleLayer($event, 'tpprob')">
              <span class="nav-text">Precipitation probability</span>
            </a>
            <span class="nav-sub-text">(%)</span>
            <div class="selettore-probabilita">
              <label *ngFor="let p of subLevels['tpprob']" class="clickable">
                <input
                  type="radio"
                  name="iff_probability"
                  [checked]="p.checked"
                  [value]="p.value"
                  (change)="changeSubLevel($event, p, 'tpprob')"
                />
                {{ p.value }}
              </label>
            </div>
          </ng-container>
        </li>
      </ng-template>
      <ng-template #cosmo>
        <li class="sidenav-item" *ngIf="varConfig.hasOwnProperty('t2m')">
          <span
            class="t2m clickable"
            (click)="toggleLayer($event, 't2m')"
            [ngClass]="{
              disabled:
                selectedLayers.length >= maxLayers &&
                !selectedLayers.includes('t2m')
            }"
            placement="left"
            [ngbTooltip]="tipTemperature"
            [disableTooltip]="!isCollapsed"
          ></span>
          <ng-template #tipTemperature
            >{{ "Temperature" | translate : lang | titlecase }}
          </ng-template>
          <a href="#" *ngIf="!isCollapsed" (click)="toggleLayer($event, 't2m')">
            <span class="nav-text" i18n>
              {{ "Temperature" | translate : lang }}
            </span>
          </a>
        </li>
        <li class="sidenav-item" *ngIf="varConfig.hasOwnProperty('prs')">
          <span
            class="prs clickable"
            (click)="toggleLayer($event, 'prs')"
            [ngClass]="{
              disabled:
                selectedLayers.length >= maxLayers &&
                !selectedLayers.includes('prs')
            }"
            placement="left"
            [ngbTooltip]="tipPressure"
            [disableTooltip]="!isCollapsed"
          ></span>
          <ng-template #tipPressure
            >{{ "Pressure" | translate : lang | titlecase }}
          </ng-template>
          <a href="#" *ngIf="!isCollapsed" (click)="toggleLayer($event, 'prs')">
            <span class="nav-text" i18n>{{
              "Pressure" | translate : lang
            }}</span>
          </a>
        </li>
        <li class="sidenav-item" *ngIf="varConfig.hasOwnProperty('rh')">
          <span
            class="rh clickable"
            (click)="toggleLayer($event, 'rh')"
            [ngClass]="{
              disabled:
                selectedLayers.length >= maxLayers &&
                !selectedLayers.includes('rh')
            }"
            placement="left"
            [ngbTooltip]="tipRelativeHumidity"
            [disableTooltip]="!isCollapsed"
          ></span>
          <ng-template #tipRelativeHumidity
            >{{ "Relative humidity" | translate : lang | titlecase }}
          </ng-template>
          <a href="#" *ngIf="!isCollapsed" (click)="toggleLayer($event, 'rh')">
            <span class="nav-text" i18n>{{
              "Relative humidity" | translate : lang
            }}</span>
          </a>
        </li>
        <li class="sidenav-item" *ngIf="varConfig.hasOwnProperty('ws10m')">
          <span
            class="ws10m clickable"
            (click)="toggleLayer($event, 'ws10m')"
            [ngClass]="{
              disabled:
                selectedLayers.length >= maxLayers &&
                !selectedLayers.includes('ws10m')
            }"
            placement="left"
            [ngbTooltip]="tipWind"
            [disableTooltip]="!isCollapsed"
          ></span>
          <ng-template #tipWind
            >{{ "Wind" | translate : lang | titlecase }}
          </ng-template>
          <a
            href="#"
            *ngIf="!isCollapsed"
            (click)="toggleLayer($event, 'ws10m')"
          >
            <span class="nav-text" i18n>{{ "Wind" | translate : lang }}</span>
          </a>
          <div
            class="form-switch wind-switch justify-content-center ms-3 d-flex mb-3"
          >
            <input
              id="windSwitch"
              type="checkbox"
              class="form-check-input clickable"
              [checked]="showScalarWind"
              (change)="toggleScalarWind()"
              [disabled]="disabledRuleScalarWindButton()"
            />
            <label class="form-check-label" for="windSwitch"></label>
            <p i18n style="font-family: 'Montserrat-semibold'; font-size: 8px">
              SCALAR FIELD
            </p>
          </div>
        </li>
        <li class="sidenav-item" *ngIf="varConfig.hasOwnProperty('prp')">
          <span
            class="prp clickable"
            (click)="toggleLayer($event, 'prp')"
            [ngClass]="{
              disabled:
                selectedLayers.length >= maxLayers &&
                !selectedLayers.includes('prp')
            }"
            placement="left"
            [ngbTooltip]="tipPrecipitation"
            [disableTooltip]="!isCollapsed"
          ></span>
          <ng-template #tipPrecipitation
            >{{ "Precipitation" | translate : lang | titlecase }}
          </ng-template>
          <ng-container *ngIf="!isCollapsed">
            <a href="#" (click)="toggleLayer($event, 'prp')">
              <span class="nav-text" i18n>{{
                "precipitation" | translate : lang
              }}</span>
            </a>
            <div class="selettore-orario">
              <div class="progressbar">
                <ng-container
                  *ngFor="let h of subLevels['prp']; let last = last"
                >
                  <label *ngIf="varConfig['prp'].includes(h.value)">
                    <input
                      type="radio"
                      name="precipitation"
                      class="clickable"
                      [value]="h.value"
                      [checked]="h.checked"
                      (change)="
                        changeSubLevel($event, h, 'prp');
                        setFirstCumulated($event, h.value, 'prp')
                      "
                      [disabled]="selectedLayers.length >= maxLayers"
                    />
                    {{ h.value + "h" }}
                  </label>
                </ng-container>
              </div>
            </div>
          </ng-container>
        </li>
        <li class="sidenav-item" *ngIf="varConfig.hasOwnProperty('sf')">
          <span
            class="sf clickable"
            (click)="toggleLayer($event, 'sf')"
            [ngClass]="{
              disabled:
                selectedLayers.length >= maxLayers &&
                !selectedLayers.includes('sf')
            }"
            placement="left"
            [ngbTooltip]="tipSnowFall"
            [disableTooltip]="!isCollapsed"
          ></span>
          <ng-template #tipSnowFall
            >{{ "Snow Fall" | translate : lang | titlecase }}
          </ng-template>
          <ng-container *ngIf="!isCollapsed">
            <a href="#" (click)="toggleLayer($event, 'sf')">
              <span class="nav-text" i18n>{{
                "Snow Fall" | translate : lang
              }}</span>
            </a>
            <div class="selettore-orario">
              <div class="progressbar">
                <ng-container
                  *ngFor="let h of subLevels['sf']; let last = last"
                >
                  <label *ngIf="varConfig['sf'].includes(h.value)">
                    <input
                      type="radio"
                      name="snow"
                      class="clickable"
                      [checked]="h.checked"
                      [value]="h.value"
                      (change)="
                        changeSubLevel($event, h, 'sf');
                        setFirstCumulated($event, h.value, 'sf')
                      "
                      [disabled]="selectedLayers.length >= maxLayers"
                    />
                    {{ h.value + "h" }}
                  </label>
                </ng-container>
              </div>
            </div>
          </ng-container>
        </li>
        <li class="sidenav-item last" *ngIf="varConfig.hasOwnProperty('cc')">
          <span
            class="cc clickable"
            (click)="toggleLayer($event, 'cc')"
            [ngClass]="{
              disabled:
                selectedLayers.length >= maxLayers &&
                !selectedLayers.includes('cc')
            }"
            placement="left"
            [ngbTooltip]="tipClouds"
            [disableTooltip]="!isCollapsed"
          ></span>
          <ng-template #tipClouds
            >{{ "Clouds" | translate : lang | titlecase }}
          </ng-template>
          <ng-container *ngIf="!isCollapsed">
            <a href (click)="toggleLayer($event, 'cc')">
              <span class="nav-text" i18n>{{
                "Clouds" | translate : lang
              }}</span>
            </a>
            <div class="selettore-clouds" *ngIf="varConfig['cc'].length">
              <label *ngFor="let lvl of subLevels['cc']">
                <input
                  type="checkbox"
                  class="clickable"
                  [name]="lvl.value"
                  [(ngModel)]="lvl.checked"
                  [value]="lvl.value"
                  (change)="changeSubLevel($event, lvl, 'cc', true)"
                  (click)="preventActions($event, lvl, 'cc')"
                  [disabled]="selectedLayers.length >= maxLayers"
                />
                {{ lvl.value }}
              </label>
              <div class="form-switch clouds-switch d-flex mb-3">
                <input
                  id="tccSwitch"
                  type="checkbox"
                  class="form-check-input clickable"
                  [checked]="showTotalClouds"
                  (change)="toggleTotalClouds('cc')"
                  [disabled]="selectedLayers.length >= maxLayers"
                />
                <label class="form-check-label" for="tccSwitch"></label>
                <p i18n>TOTAL</p>
              </div>
            </div>
          </ng-container>
        </li>
      </ng-template>
      <!-- base layer map selector -->
      <li class="sidenav-item last selettore-carte" *ngIf="mode == modes.adv">
        <span class="carte"></span>
        <ng-container *ngIf="!isCollapsed">
          <a href="#">
            <span class="nav-text">Map Style</span>
          </a>
          <div class="selettore-mappa">
            <label *ngFor="let baseLayer of baseLayers | keyvalue">
              <input
                type="radio"
                name="baseMap"
                [(ngModel)]="selectedBaseLayer"
                [value]="baseLayer.key"
                (change)="changeBaseLayer(baseLayer.key)"
              />
              {{ baseLayer.key }}
            </label>
          </div>
        </ng-container>
      </li>
      <!-- zoom-in -->
      <li class="sidenav-item zoom" *ngIf="mode == modes.adv">
        <span
          class="plus clickable"
          [ngClass]="{ isDisabled: zLevel === map.getMaxZoom() }"
          (click)="zoom($event, 'in')"
          placement="left"
          [ngbTooltip]="'Zoom in'"
          [disableTooltip]="!isCollapsed"
        ></span>
        <a href="#" *ngIf="!isCollapsed" (click)="zoom($event, 'in')">
          <span
            class="nav-text"
            [ngClass]="{ isDisabled: zLevel === map.getMaxZoom() }"
            i18n
            >Zoom in</span
          >
        </a>
      </li>
      <!-- zoom-out -->
      <li class="sidenav-item last" *ngIf="mode == modes.adv">
        <span
          class="minus clickable"
          [ngClass]="{ isDisabled: zLevel === map.getMinZoom() }"
          (click)="zoom($event, 'out')"
          placement="left"
          [ngbTooltip]="'Zoom out'"
          [disableTooltip]="!isCollapsed"
        ></span>
        <a href="#" *ngIf="!isCollapsed" (click)="zoom($event, 'out')">
          <span
            class="nav-text"
            [ngClass]="{ isDisabled: zLevel === map.getMinZoom() }"
            i18n
            >Zoom out</span
          >
        </a>
      </li>
    </ul>
  </div>
</nav>
