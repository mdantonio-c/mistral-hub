<div style="position: relative">
  <div class="modal-header">
    <h4 class="modal-title">
      {{ "Station" | translate : lang }} : {{ getName() || "n/a" }}
    </h4>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="activeModal.dismiss()"
    ></button>
  </div>
  <div class="modal-body">
    <ngx-spinner
      type="ball-scale-multiple"
      [name]="'timeseries-spinner'"
      bdColor="rgba(255,255,255,0.8)"
      color="#6c757d"
      zIndex="1000"
      [fullScreen]="false"
      size="medium"
    >
    </ngx-spinner>
    <div class="row .g-0" style="min-height: 100px">
      <div class="col-lg-3 mb-2 position-relative" *ngIf="report">
        <div class="card mb-3" style="max-width: 18rem">
          <div class="card-header">
            <i class="fas fa-circle-info me-1"></i
            >{{ "Station details" | translate : lang }}
          </div>
          <div class="card-body text-dark px-3 py-1">
            <ul class="list-group list-group-flush">
              <li
                class="list-group-item px-0 py-1"
                *ngFor="let d of filteredStationDetails"
              >
                <p class="h6 my-0">
                  {{
                    descriptions[d.var].descr
                      .toLowerCase()
                      .charAt(0)
                      .toUpperCase() +
                      descriptions[d.var].descr.toLowerCase().slice(1)
                      | replace : "\\(([^\\)]+)\\)" : ""
                      | translate : lang
                  }}
                </p>
                <small
                  >{{ d.val }}
                  <span *ngIf="d.var === 'B07030'">
                    {{ giveMeMetres() }}
                  </span></small
                >
              </li>
            </ul>
          </div>
        </div>
        <div *ngIf="active === 'mixwind-0' || canShowCombinedTools()">
          <div class="card mb-3" style="max-width: 18rem">
            <div class="card-header">
              <i class="fas fa-wrench me-1"></i>{{ "Tools" | translate : lang }}
            </div>
            <div class="card-body text-dark px-3 py-1">
              <ul class="list-group list-group-flush">
                <li
                  *ngIf="active === 'mixwind-0'"
                  class="list-group-item px-0 py-1"
                >
                  <div class="form-switch wind-switch d-flex mt-2">
                    <input
                      id="windSwitchModal"
                      type="checkbox"
                      class="form-check-input clickable"
                      [(ngModel)]="flagUnit"
                      (change)="toggleWindSpeedUnit()"
                    />
                    <label
                      class="form-check-label"
                      for="windSwitchModal"
                    ></label>
                    <span class="wind-switch ms-2">m/s <-> km/h</span>
                  </div>
                </li>
                <li
                  class="list-group-item px-0 py-1"
                  *ngIf="canShowCombinedTools() && active !== 'mixwind-0'"
                >
                  <div class="form-switch d-flex mt-2">
                    <input
                      type="checkbox"
                      class="form-check-input clickable"
                      [(ngModel)]="combinedMode"
                      (change)="onCombinedModeToggle()"
                      id="combinedSwitch"
                    />
                    <label class="form-check-label" for="combinedSwitch">
                    </label
                    ><span class="wind-switch ms-2">
                      {{ "Overlay variables" | translate : lang }}</span
                    >
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <!--
        <div class="text-center mt-4">
          <button
            type="button"
            class="btn btn-primary no-rounded ms-2"
            (click)="download()"
            [disabled]="true"
          >
            <i class="fas fa-download"></i>
            Download
          </button>
        </div>
        -->
        <div
          class="card-body text-dark px-3 py-1 position-absolute end-0 bottom-0 text-end"
          style="font-size: 0.7rem"
        >
          <i class="fas fa-clock me-1"></i> Local time {{ checkUTCShift() }}
        </div>
      </div>
      <div class="col-lg-9" *ngIf="report">
        <div class="card text-center">
          <div class="card-body">
            <ul
              ngbNav
              #nav="ngbNav"
              [(activeId)]="active"
              class="nav-pills"
              orientation="horizontal"
              style="font-size: small"
            >
              <ng-container *ngFor="let p of report.prod">
                <ng-container
                  *ngIf="
                    (existMixWindProduct &&
                      p.var !== 'B11001' &&
                      p.var !== 'B11002') ||
                    !existMixWindProduct
                  "
                >
                  <li
                    class="border border-primary rounded m-1"
                    [ngbNavItem]="getNavItemName(p)"
                    [ngClass]="{
                      'my-active': isTabSelected(getNavItemName(p))
                    }"
                  >
                    <a ngbNavLink (click)="onTabClick(getNavItemName(p))">{{
                      descriptions[p.var].descr | translate : lang | uppercase
                    }}</a>
                    <ng-template ngbNavContent></ng-template>
                  </li>
                </ng-container>
              </ng-container>
              <li
                ngbNavItem="mixwind-0"
                class="border border-primary rounded m-1"
                [ngClass]="{ 'my-active': isTabSelected('mixwind-0') }"
                *ngIf="existMixWindProduct"
              >
                <a ngbNavLink (click)="onTabClick('mixwind-0')">{{
                  "Wind" | translate : lang | uppercase
                }}</a>
                <ng-template ngbNavContent></ng-template>
              </li>
            </ul>
            <div [ngbNavOutlet]="nav"></div>
            <p class="text-justify">
              <ng-container *ngIf="extendedVisualization">
                <br /><small>
                  <b>{{ "Level" | translate : lang }}:</b>
                  {{
                    descriptions[single[0]["level"]].descr | translate : lang
                  }}</small
                >
              </ng-container>
              <ng-container *ngIf="extendedVisualization">
                <br /><small>
                  <b>{{ "Timerange" | translate : lang }}:</b>
                  {{
                    descriptions[single[0]["timerange"]].descr
                      | translate : lang
                  }}</small
                >
              </ng-container>
            </p>
            <!--<pre>{{nav.activeId}}</pre>-->
            <div #containerRef>
              <ng-container
                [ngSwitch]="
                  showCombined ? 'COMBINED' : nav.activeId.split('-')[0]
                "
              >
                <div *ngSwitchCase="'B13011'">
                  <ng-container *ngTemplateOutlet="comboChart"></ng-container>
                </div>
                <div *ngSwitchCase="'mixwind'">
                  <ng-container
                    *ngTemplateOutlet="comboChartWind"
                  ></ng-container>
                </div>
                <div *ngSwitchCase="'COMBINED'">
                  <ng-container
                    *ngTemplateOutlet="
                      !combinedPrec
                        ? comboCombinedChart
                        : comboChartPrecCombined
                    "
                  ></ng-container>
                </div>
                <div *ngSwitchDefault>
                  <ng-container *ngTemplateOutlet="lineChart"></ng-container>
                </div>
              </ng-container>
              <ng-template #lineChart>
                <custom-ngx-charts-line-chart
                  [view]="[containerRef.offsetWidth - 100, 400]"
                  [animations]="true"
                  [scheme]="multiColorScheme"
                  [xAxis]="true"
                  [yAxis]="true"
                  [yScaleMin]="yScaleMin"
                  [yScaleMax]="yScaleMax"
                  [showXAxisLabel]="true"
                  [showYAxisLabel]="true"
                  [xAxisLabel]="xAxisLabelFormatting()"
                  [yAxisLabel]="getUserUnit(active) || 'n/a'"
                  [xAxisTickFormatting]="xAxisTickFormattingFn"
                  [scaleType]="'time'"
                  [xAxisTicks]="xTicks"
                  [yAxisTicks]="yAxisTicks"
                  [dateInterval]="dateInterval"
                  [gridLineNgStyleByXAxisTick]="onlyDateChangeNgStyleFn"
                  [rotateXAxisTicks]="false"
                  [timeline]="false"
                  [results]="singleDates"
                  [autoScale]="false"
                  [trimXAxisTicks]="false"
                  [curve]="curve"
                  [referenceLines]="referenceLines"
                  [showRefLines]="flagRed"
                  [showRefLabels]="false"
                  [showGridLines]="true"
                >
                  <ng-template #tooltipTemplate let-model="model">
                    <span class="d-block"
                      ><b>{{
                        model.name | fmtLabelDate : "it" : true
                      }}</b></span
                    >
                    <span class="d-block"
                      >{{ model.series | translate : "it" }}:
                      {{ model.value }}</span
                    >
                  </ng-template>
                  <ng-template #seriesTooltipTemplate let-model="model">
                    <div class="area-tooltip-container">
                      <span class="d-block"
                        ><b>{{
                          model[0].name | fmtLabelDate : "it" : true
                        }}</b></span
                      >
                      <div class="tooltip-item">
                        <span
                          class="tooltip-item-color"
                          [style.background-color]="model[0].color"
                        ></span>
                        {{
                          model[0].series
                            .toLowerCase()
                            .charAt(0)
                            .toUpperCase() +
                            model[0].series.toLowerCase().slice(1)
                            | replace : "\\(([^\\)]+)\\)" : ""
                            | translate : lang
                        }}: <b>{{ model[0].value }}</b>
                      </div>
                    </div>
                  </ng-template>
                </custom-ngx-charts-line-chart>
              </ng-template>
              <ng-template #comboChart>
                <combo-chart-component
                  [view]="[containerRef.offsetWidth - 100, 400]"
                  [scheme]="monoBarSchemeRain"
                  [colorSchemeLine]="monoLineSchemeRain"
                  [results]="singleDates[0].series"
                  [animations]="true"
                  [lineChart]="accumulatedSeriesDates"
                  [tooltipDisabled]="false"
                  [yLeftAxisScaleFactor]="yLeftAxisScale"
                  [yRightAxisScaleFactor]="yRightAxisScale"
                  [gradient]="false"
                  [xAxis]="true"
                  [yAxis]="true"
                  [xAxisTicks]="xTicks"
                  [dateInterval]="dateInterval"
                  [autoScale]="false"
                  [legend]="false"
                  [rotateXAxisTicks]="false"
                  [showGridLines]="true"
                  [showXAxisLabel]="true"
                  [showYAxisLabel]="true"
                  [showRightYAxisLabel]="true"
                  [xAxisLabel]="xAxisLabelFormatting()"
                  [xAxisTickFormatting]="xAxisTickFormattingFn"
                  [yAxisLabel]="
                    ('1h precipitation' | translate : lang) + ' (mm)'
                  "
                  [yAxisLabelRight]="
                    ('Accumulated precipitation' | translate : lang) + ' (mm)'
                  "
                  [gridLineNgStyleByXAxisTick]="onlyDateChangeNgStyleFn"
                >
                  <ng-template #tooltipTemplate let-model="model">
                    <span class="d-block">{{
                      model.name | fmtLabelDate : "it" : true
                    }}</span>
                    <span class="d-block"
                      >{{ model.series | translate : lang }}:
                      {{ model.value }} (mm)</span
                    >
                  </ng-template>
                  <ng-template #seriesTooltipTemplate let-model="model">
                    <div class="area-tooltip-container">
                      <span class="d-block"
                        ><b>{{
                          model[0].name | fmtLabelDate : "it" : true
                        }}</b></span
                      >
                      <div
                        *ngFor="let tooltipItem of model"
                        class="tooltip-item"
                      >
                        <span
                          class="tooltip-item-color"
                          [style.background-color]="
                            !tooltipItem.series.includes('1h')
                              ? tooltipItem.color
                              : monoBarSchemeRain.domain[0]
                          "
                        ></span>
                        {{
                          tooltipItem.series
                            .toLowerCase()
                            .charAt(0)
                            .toUpperCase() +
                            tooltipItem.series.toLowerCase().slice(1)
                            | replace : "\\(([^\\)]+)\\)" : ""
                            | translate : lang
                        }}: <b>{{ tooltipItem.value }}</b> (mm)
                      </div>
                    </div>
                  </ng-template>
                </combo-chart-component>
              </ng-template>

              <ng-template #comboChartWind
                >{{ "" }}
                <div style="max-width: 800px; overflow: auto">
                  <combo-chart-wind-component
                    [view]="[
                      widhtOfWindData()
                        ? widhtOfWindData()
                        : containerRef.offsetWidth,
                      400
                    ]"
                    [curve]="curve"
                    [scheme]="monoBarSchemeWind"
                    [colorSchemeLine]="monoLineSchemeWind"
                    [animations]="true"
                    [results]="windDirectionSeries"
                    [lineChart]="singleDates"
                    [tooltipDisabled]="false"
                    [yLeftAxisScaleFactor]="yLeftAxisScale"
                    [gradient]="false"
                    [xAxis]="true"
                    [yAxis]="true"
                    [xAxisTicks]="xTicks"
                    [dateInterval]="dateInterval"
                    [autoscale]="false"
                    [legend]="false"
                    [showXAxisLabel]="true"
                    [showYAxisLabel]="true"
                    [xAxisLabel]="xAxisLabelFormatting()"
                    [xAxisTickFormatting]="xAxisTickFormattingFn"
                    [yAxisLabel]="
                      flagUnit
                        ? ('Wind speed' | translate : lang) + ' (km/h)'
                        : ('Wind speed' | translate : lang) + ' (m/s)'
                    "
                    [gridLineNgStyleByXAxisTick]="xAxisNgStyleFn"
                  >
                    <ng-template #seriesTooltipTemplate let-model="model">
                      <div class="area-tooltip-container">
                        <span class="d-block"
                          ><b>{{
                            model[0].name | fmtLabelDate : "it" : true
                          }}</b></span
                        >
                        <div
                          *ngFor="let tooltipItem of model"
                          class="tooltip-item"
                        >
                          <span
                            class="tooltip-item-color"
                            [style.background-color]="
                              tooltipItem.series.includes('DIRECTION')
                                ? monoBarSchemeWind.domain[0]
                                : monoLineSchemeWind.domain[0]
                            "
                          ></span>
                          {{
                            tooltipItem.series
                              .toLowerCase()
                              .charAt(0)
                              .toUpperCase() +
                              tooltipItem.series.toLowerCase().slice(1)
                              | replace : "\\(([^\\)]+)\\)" : ""
                              | translate : lang
                          }}: <b>{{ tooltipItem.value }}</b>
                          {{
                            tooltipItem.series.includes("DIRECTION")
                              ? " (Â°)"
                              : flagUnit
                              ? " (km/h)"
                              : " (m/s)"
                          }}
                        </div>
                      </div>
                    </ng-template>
                  </combo-chart-wind-component>
                </div>
              </ng-template>
              <ng-template #comboCombinedChart>
                <combo-chart-combined-component
                  [view]="[containerRef.offsetWidth - 100, 400]"
                  [customColors]="combinedCustomColorsCombo"
                  [scheme]="monoBarSchemeRain"
                  [colorSchemeLine]="monoLineSchemeRain"
                  [results]="var1[0].series"
                  [namevar1]="var1[0].name"
                  [animations]="true"
                  [lineChart]="var2"
                  [tooltipDisabled]="false"
                  [yLeftAxisScaleFactor]="yLeftAxisScale"
                  [yRightAxisScaleFactor]="yRightAxisScale"
                  [gradient]="false"
                  [xAxis]="true"
                  [yAxis]="true"
                  [xAxisTicks]="xTicks"
                  [dateInterval]="dateInterval"
                  [autoScale]="false"
                  [legend]="showCombined"
                  [rotateXAxisTicks]="false"
                  [showGridLines]="true"
                  [showXAxisLabel]="true"
                  [showYAxisLabel]="true"
                  [showRightYAxisLabel]="true"
                  [xAxisLabel]="xAxisLabelFormatting()"
                  [xAxisTickFormatting]="xAxisTickFormattingFn"
                  [yAxisLabel]="yLeftLabel"
                  [yAxisLabelRight]="yRightLabel"
                  [gridLineNgStyleByXAxisTick]="onlyDateChangeNgStyleFn"
                  [referenceLines]="referenceLines"
                  [showRefLines]="flagRed"
                  [showRefLabels]="false"
                  [flagRed2]="flagRed2"
                  [yAxisTicks]="yAxisTicks"
                >
                  <ng-template #tooltipTemplate let-model="model">
                    <span class="d-block">{{
                      model.name | fmtLabelDate : "it" : true
                    }}</span>
                    <span class="d-block"
                      >{{ model.series | translate : lang }}: {{ model.value }}
                    </span>
                  </ng-template>
                  <ng-template #seriesTooltipTemplate let-model="model">
                    <div class="area-tooltip-container">
                      <span class="d-block"
                        ><b>{{
                          model[0].name | fmtLabelDate : "it" : true
                        }}</b></span
                      >
                      <div
                        *ngFor="let tooltipItem of model"
                        class="tooltip-item"
                      >
                        <span
                          class="tooltip-item-color"
                          [style.background-color]="
                            tooltipItem.series
                              .toLowerCase()
                              .includes(
                                var1[0].name.split(' ')[0].toLowerCase()
                              )
                              ? monoLineSchemeWind.domain[0]
                              : monoLineSchemeRain.domain[0]
                          "
                        ></span>
                        {{
                          tooltipItem.series
                            .toLowerCase()
                            .charAt(0)
                            .toUpperCase() +
                            tooltipItem.series.toLowerCase().slice(1)
                            | replace : "\\(([^\\)]+)\\)" : ""
                            | translate : lang
                        }}: <b>{{ tooltipItem.value }}</b>
                        {{
                          tooltipItem.series
                            .toLowerCase()
                            .includes(var1[0].name.split(" ")[0].toLowerCase())
                            ? unit1
                            : unit2
                        }}
                      </div>
                    </div>
                  </ng-template>
                </combo-chart-combined-component>
              </ng-template>
              <ng-template #comboChartPrecCombined>
                <combo-chart-component
                  [view]="[containerRef.offsetWidth - 100, 400]"
                  [customColors]="combinedCustomColorsComboPrec"
                  [scheme]="monoBarSchemeRain"
                  [colorSchemeLine]="monoLineSchemeRain"
                  [results]="var1[0].series"
                  [animations]="true"
                  [lineChart]="var2"
                  [tooltipDisabled]="false"
                  [yLeftAxisScaleFactor]="yLeftAxisScale"
                  [yRightAxisScaleFactor]="yRightAxisScale"
                  [gradient]="false"
                  [xAxis]="true"
                  [yAxis]="true"
                  [xAxisTicks]="xTicks"
                  [dateInterval]="dateInterval"
                  [autoScale]="false"
                  [legend]="showCombined"
                  [rotateXAxisTicks]="false"
                  [showGridLines]="true"
                  [showXAxisLabel]="true"
                  [showYAxisLabel]="true"
                  [autoScaleRightYAxis]="combinedPrec"
                  [showRightYAxisLabel]="true"
                  [xAxisLabel]="xAxisLabelFormatting()"
                  [xAxisTickFormatting]="xAxisTickFormattingFn"
                  [yAxisLabel]="yLeftLabel"
                  [yAxisLabelRight]="yRightLabel"
                  [gridLineNgStyleByXAxisTick]="onlyDateChangeNgStyleFn"
                  [referenceLines]="referenceLines"
                  [showRefLines]="flagRed"
                  [showRefLabels]="false"
                  [flagRed2]="flagRed2"
                >
                  <ng-template #tooltipTemplate let-model="model">
                    <span class="d-block">{{
                      model.name | fmtLabelDate : "it" : true
                    }}</span>
                    <span class="d-block"
                      >{{ model.series | translate : lang }}:
                      {{ model.value }}</span
                    >
                  </ng-template>
                  <ng-template #seriesTooltipTemplate let-model="model">
                    <div class="area-tooltip-container">
                      <span class="d-block"
                        ><b>{{
                          model[0].name | fmtLabelDate : "it" : true
                        }}</b></span
                      >
                      <div
                        *ngFor="let tooltipItem of model"
                        class="tooltip-item"
                      >
                        <span
                          class="tooltip-item-color"
                          [style.background-color]="
                            tooltipItem.series
                              .toLowerCase()
                              .includes(
                                var1[0].name.split(' ')[0].toLowerCase()
                              )
                              ? monoBarSchemeRain.domain[0]
                              : monoLineSchemeRain.domain[0]
                          "
                        ></span>
                        {{
                          tooltipItem.series
                            .toLowerCase()
                            .charAt(0)
                            .toUpperCase() +
                            tooltipItem.series.toLowerCase().slice(1)
                            | replace : "\\(([^\\)]+)\\)" : ""
                            | translate : lang
                        }}: <b>{{ tooltipItem.value }}</b>
                        {{
                          tooltipItem.series
                            .toLowerCase()
                            .includes(var1[0].name.split(" ")[0].toLowerCase())
                            ? unit1
                            : unit2
                        }}
                      </div>
                    </div>
                  </ng-template>
                </combo-chart-component>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <!--
  <div class="modal-footer">
    <button
      type="button"
      class="btn btn-outline-dark"
      (click)="activeModal.close('Close click')"
    >
      Close
    </button>
  </div>
  -->
</div>
